<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil | PeakExplorer</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="profile-page">
    <!-- Navigation -->
    <nav class="navbar navbar-dark">
        <a href="index (2).html" class="logo" onclick="if(window.location.pathname.includes('index')) { location.reload(); return false; }">
            <span class="logo-icon">‚õ∞Ô∏è</span>
            <span class="logo-text">PeakExplorer</span>
        </a>
        <ul class="nav-links">
            <li><a href="index (2).html">Ana S…ôhif…ô</a></li>
            <li><a href="index (2).html#mountains">Daƒülar</a></li>
            <li class="nav-dropdown-item">
                <a href="index (2).html#tours" class="nav-dropdown-trigger">Turlar ‚ñæ</a>
                <div class="nav-submenu">
                    <a href="index (2).html#tours" class="submenu-item">
                        <span class="submenu-icon">üåü</span>
                        <span>Popular Turlar</span>
                    </a>
                    <a href="hotels.html" class="submenu-item">
                        <span class="submenu-icon">üè®</span>
                        <span>Otell…ôr</span>
                    </a>
                    <a href="restaurants.html" class="submenu-item">
                        <span class="submenu-icon">üçΩÔ∏è</span>
                        <span>Restoranlar</span>
                    </a>
                    <a href="car-rental.html" class="submenu-item">
                        <span class="submenu-icon">üöó</span>
                        <span>Ma≈üƒ±n Kiray…ôsi</span>
                    </a>
                </div>
            </li>
            <li><a href="index (2).html#map">X…ôrit…ô</a></li>
            <li><a href="index (2).html#gallery">Qalereya</a></li>
        </ul>
        <div class="nav-actions">
            <!-- Search -->
            <div class="nav-search">
                <button class="search-toggle-btn" title="Axtar">üîç</button>
            </div>
            
            <!-- Menu Dropdown -->
            <div class="nav-dropdown menu-dropdown">
                <button class="nav-dropdown-btn">
                    <span>‚ò∞</span>
                    <span>Menyu</span>
                </button>
                <div class="nav-dropdown-content">
                    <a href="about.html">Haqqƒ±mƒ±zda</a>
                    <a href="contact.html">∆èlaq…ô</a>
                    <a href="blog.html">Blog</a>
                    <a href="faq.html">FAQ</a>
                </div>
            </div>
            
            <!-- Dil se√ßimi Dropdown -->
            <div class="nav-dropdown lang-dropdown">
                <button class="nav-dropdown-btn">
                    <span class="lang-current">AZ</span>
                </button>
                <div class="nav-dropdown-content">
                    <button class="lang-option active" data-lang="az">
                        <span class="lang-flag">üá¶üáø</span>
                        <span>Az…ôrbaycan</span>
                    </button>
                    <button class="lang-option" data-lang="en">
                        <span class="lang-flag">üá¨üáß</span>
                        <span>English</span>
                    </button>
                    <button class="lang-option" data-lang="ru">
                        <span class="lang-flag">üá∑üá∫</span>
                        <span>–†—É—Å—Å–∫–∏–π</span>
                    </button>
                    <button class="lang-option" data-lang="tr">
                        <span class="lang-flag">üáπüá∑</span>
                        <span>T√ºrk√ße</span>
                    </button>
                </div>
            </div>
            
            <!-- Logout button for profile page -->
            <button class="auth-btn logout-btn" id="logoutBtn">√áƒ±xƒ±≈ü</button>
        </div>
    </nav>

    <!-- Profile Header -->
    <section class="profile-header profile-header-compact">
        <div class="profile-info-container">
            <div class="profile-avatar-large" id="profileAvatar">
                <img src="" alt="Profile" id="avatarImage" style="display: none;">
                <span id="avatarPlaceholder">üë§</span>
                <label class="avatar-upload-btn" for="avatarInput" title="≈û…ôkil y√ºkl…ô">
                    üì∑
                </label>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
            </div>
            <div class="profile-main-info">
                <h1 id="profileName">ƒ∞stifad…ô√ßi Adƒ±</h1>
                <p class="profile-email" id="profileEmail">email@example.com</p>
                <p class="profile-joined" id="profileJoined">
                    <span data-lang-az="Qo≈üulma tarixi:" data-lang-en="Joined:">Qo≈üulma tarixi:</span>
                    <span id="joinedDate">-</span>
                </p>
                <div class="first-trip-discount-badge" id="discountBadge" style="display: none;">
                    <span class="discount-icon">üéâ</span>
                    <span id="discountBadgeText" data-lang-az="ƒ∞lk gedi≈ü √º√ß√ºn 15% endirim!" data-lang-en="15% off for your first trip!">ƒ∞lk gedi≈ü √º√ß√ºn 15% endirim!</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Content -->
    <section class="profile-content">
        <div class="profile-container">
            <!-- Sidebar -->
            <aside class="profile-sidebar">
                <nav class="profile-nav">
                    <button class="profile-nav-item active" data-tab="info">
                        <span class="nav-icon">üë§</span>
                        <span data-lang-az="≈û…ôxsi M…ôlumatlar" data-lang-en="Personal Info">≈û…ôxsi M…ôlumatlar</span>
                    </button>
                    <button class="profile-nav-item" data-tab="bookings">
                        <span class="nav-icon">üé´</span>
                        <span data-lang-az="Sifari≈ül…ôrim" data-lang-en="My Bookings">Sifari≈ül…ôrim</span>
                    </button>
                    <button class="profile-nav-item" data-tab="favorites">
                        <span class="nav-icon">‚ù§Ô∏è</span>
                        <span data-lang-az="Sevimlil…ôr" data-lang-en="Favorites">Sevimlil…ôr</span>
                    </button>
                    <button class="profile-nav-item" data-tab="reviews">
                        <span class="nav-icon">‚≠ê</span>
                        <span data-lang-az="R…ôyl…ôrim" data-lang-en="My Reviews">R…ôyl…ôrim</span>
                    </button>
                    <button class="profile-nav-item" data-tab="settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span data-lang-az="T…ônziml…ôm…ôl…ôr" data-lang-en="Settings">T…ônziml…ôm…ôl…ôr</span>
                    </button>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="profile-main">
                <!-- ≈û…ôxsi M…ôlumatlar Tab -->
                <div class="profile-tab active" id="tab-info">
                    <div class="tab-header">
                        <h2 data-lang-az="≈û…ôxsi M…ôlumatlar" data-lang-en="Personal Information">≈û…ôxsi M…ôlumatlar</h2>
                        <button class="edit-btn" id="editProfileBtn" data-lang-az="Redakt…ô et" data-lang-en="Edit">Redakt…ô et</button>
                    </div>
                    
                    <form class="profile-form" id="profileForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label data-lang-az="Ad Soyad" data-lang-en="Full Name">Ad Soyad</label>
                                <input type="text" id="editName" disabled>
                            </div>
                            <div class="form-group">
                                <label data-lang-az="E-po√ßt" data-lang-en="Email">E-po√ßt</label>
                                <input type="email" id="editEmail" disabled>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label data-lang-az="Telefon" data-lang-en="Phone">Telefon</label>
                                <input type="tel" id="editPhone" disabled placeholder="+994 XX XXX XX XX">
                            </div>
                            <div class="form-group">
                                <label data-lang-az="Doƒüum tarixi" data-lang-en="Birth Date">Doƒüum tarixi</label>
                                <input type="date" id="editBirthdate" disabled>
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label data-lang-az="√únvan" data-lang-en="Address">√únvan</label>
                            <input type="text" id="editAddress" disabled placeholder="≈û…ôh…ôr, Rayon">
                        </div>
                        <div class="form-group full-width">
                            <label data-lang-az="Haqqƒ±mda" data-lang-en="About Me">Haqqƒ±mda</label>
                            <textarea id="editBio" rows="3" disabled placeholder="√ñz√ºn√ºz haqqƒ±nda qƒ±sa m…ôlumat..."></textarea>
                        </div>
                        <div class="form-actions" id="formActions" style="display: none;">
                            <button type="button" class="cancel-btn" id="cancelEditBtn" data-lang-az="L…ôƒüv et" data-lang-en="Cancel">L…ôƒüv et</button>
                            <button type="submit" class="save-btn" data-lang-az="Yadda saxla" data-lang-en="Save">Yadda saxla</button>
                        </div>
                    </form>
                </div>

                <!-- Sifari≈ül…ôrim Tab -->
                <div class="profile-tab" id="tab-bookings">
                    <div class="tab-header">
                        <h2 data-lang-az="Sifari≈ül…ôrim" data-lang-en="My Bookings">Sifari≈ül…ôrim</h2>
                    </div>
                    
                    <div class="bookings-list" id="bookingsList">
                        <div class="empty-state">
                            <span class="empty-icon">üé´</span>
                            <h3 data-lang-az="H…ôl…ô sifari≈ü yoxdur" data-lang-en="No bookings yet">H…ôl…ô sifari≈ü yoxdur</h3>
                            <p data-lang-az="Turlarƒ± k…ô≈üf edin v…ô ilk sifari≈üinizi verin!" data-lang-en="Explore tours and make your first booking!">Turlarƒ± k…ô≈üf edin v…ô ilk sifari≈üinizi verin!</p>
                            <a href="index (2).html#tours" class="explore-btn" data-lang-az="Turlarƒ± K…ô≈üf Et" data-lang-en="Explore Tours">Turlarƒ± K…ô≈üf Et</a>
                        </div>
                    </div>
                </div>

                <!-- Sevimlil…ôr Tab -->
                <div class="profile-tab" id="tab-favorites">
                    <div class="tab-header">
                        <h2 data-lang-az="Sevimlil…ôr" data-lang-en="Favorites">Sevimlil…ôr</h2>
                    </div>
                    
                    <!-- Daƒülar -->
                    <div class="favorites-section">
                        <h3 class="favorites-section-title">
                            <span>üèîÔ∏è</span>
                            <span data-lang-az="Sevimli Daƒülar" data-lang-en="Favorite Mountains">Sevimli Daƒülar</span>
                        </h3>
                        <div class="favorites-grid" id="favoriteMountainsList"></div>
                    </div>
                    
                    <!-- Turlar -->
                    <div class="favorites-section">
                        <h3 class="favorites-section-title">
                            <span>üé´</span>
                            <span data-lang-az="Sevimli Turlar" data-lang-en="Favorite Tours">Sevimli Turlar</span>
                        </h3>
                        <div class="favorites-grid" id="favoriteToursList"></div>
                    </div>
                </div>

                <!-- R…ôyl…ôrim Tab -->
                <div class="profile-tab" id="tab-reviews">
                    <div class="tab-header">
                        <h2 data-lang-az="R…ôyl…ôrim" data-lang-en="My Reviews">R…ôyl…ôrim</h2>
                    </div>
                    
                    <div class="reviews-list" id="reviewsList">
                        <div class="empty-state">
                            <span class="empty-icon">‚≠ê</span>
                            <h3 data-lang-az="H…ôl…ô r…ôy yoxdur" data-lang-en="No reviews yet">H…ôl…ô r…ôy yoxdur</h3>
                            <p data-lang-az="Daƒülarƒ± ziyar…ôt edin v…ô r…ôyinizi payla≈üƒ±n!" data-lang-en="Visit mountains and share your review!">Daƒülarƒ± ziyar…ôt edin v…ô r…ôyinizi payla≈üƒ±n!</p>
                            <a href="index (2).html#mountains" class="explore-btn" data-lang-az="Daƒülarƒ± K…ô≈üf Et" data-lang-en="Explore Mountains">Daƒülarƒ± K…ô≈üf Et</a>
                        </div>
                    </div>
                </div>

                <!-- T…ônziml…ôm…ôl…ôr Tab -->
                <div class="profile-tab" id="tab-settings">
                    <div class="tab-header">
                        <h2 data-lang-az="T…ônziml…ôm…ôl…ôr" data-lang-en="Settings">T…ônziml…ôm…ôl…ôr</h2>
                    </div>
                    
                    <div class="settings-section">
                        <h3 data-lang-az="≈ûifr…ôni D…ôyi≈ü" data-lang-en="Change Password">≈ûifr…ôni D…ôyi≈ü</h3>
                        <form class="settings-form" id="passwordForm">
                            <div class="form-group">
                                <label data-lang-az="Cari ≈üifr…ô" data-lang-en="Current Password">Cari ≈üifr…ô</label>
                                <input type="password" id="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label data-lang-az="Yeni ≈üifr…ô" data-lang-en="New Password">Yeni ≈üifr…ô</label>
                                <input type="password" id="newPassword" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label data-lang-az="Yeni ≈üifr…ôni t…ôsdiql…ô" data-lang-en="Confirm New Password">Yeni ≈üifr…ôni t…ôsdiql…ô</label>
                                <input type="password" id="confirmNewPassword" required>
                            </div>
                            <div class="form-error" id="passwordError"></div>
                            <button type="submit" class="save-btn" data-lang-az="≈ûifr…ôni Yenil…ô" data-lang-en="Update Password">≈ûifr…ôni Yenil…ô</button>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3 data-lang-az="Bildiri≈ül…ôr" data-lang-en="Notifications">Bildiri≈ül…ôr</h3>
                        <div class="settings-options">
                            <label class="toggle-option">
                                <span data-lang-az="E-po√ßt bildiri≈ül…ôri" data-lang-en="Email notifications">E-po√ßt bildiri≈ül…ôri</span>
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label class="toggle-option">
                                <span data-lang-az="Tur yenilikl…ôri" data-lang-en="Tour updates">Tur yenilikl…ôri</span>
                                <input type="checkbox" id="tourUpdates" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label class="toggle-option">
                                <span data-lang-az="X√ºsusi t…ôklifl…ôr" data-lang-en="Special offers">X√ºsusi t…ôklifl…ôr</span>
                                <input type="checkbox" id="specialOffers">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section danger-zone">
                        <h3 data-lang-az="T…ôhl√ºk…ôli Zona" data-lang-en="Danger Zone">T…ôhl√ºk…ôli Zona</h3>
                        <p data-lang-az="Hesabƒ±nƒ±zƒ± silm…ôk ist…ôyirsiniz? Bu …ôm…ôliyyat geri qaytarƒ±la bilm…ôz." data-lang-en="Want to delete your account? This action cannot be undone.">Hesabƒ±nƒ±zƒ± silm…ôk ist…ôyirsiniz? Bu …ôm…ôliyyat geri qaytarƒ±la bilm…ôz.</p>
                        <button class="delete-account-btn" id="deleteAccountBtn" data-lang-az="Hesabƒ± Sil" data-lang-en="Delete Account">Hesabƒ± Sil</button>
                    </div>
                </div>
            </main>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-bottom">
            <p data-lang-az="¬© 2025 PeakExplorer. B√ºt√ºn h√ºquqlar qorunur." data-lang-en="¬© 2025 PeakExplorer. All rights reserved.">¬© 2025 PeakExplorer. B√ºt√ºn h√ºquqlar qorunur.</p>
        </div>
    </footer>

    <script>
        // Dil sistemi
        let currentLanguage = localStorage.getItem('language') || 'az';
        
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            document.querySelectorAll('[data-lang-az]').forEach(el => {
                const text = el.getAttribute(`data-lang-${lang}`);
                if (text) el.textContent = text;
            });
            
            document.documentElement.lang = lang;
        }

        // ƒ∞stifad…ô√ßi m…ôlumatlarƒ±
        const USERS_KEY = 'peakexplorer_users';
        const CURRENT_USER_KEY = 'peakexplorer_current_user';
        
        function getCurrentUser() {
            const user = localStorage.getItem(CURRENT_USER_KEY);
            return user ? JSON.parse(user) : null;
        }
        
        function getUsers() {
            const users = localStorage.getItem(USERS_KEY);
            return users ? JSON.parse(users) : [];
        }
        
        function saveUsers(users) {
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
        }
        
        function updateCurrentUser(userData) {
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userData));
        }

        // Profil m…ôlumatlarƒ±nƒ± y√ºkl…ô
        function loadProfile() {
            const currentUser = getCurrentUser();
            
            if (!currentUser) {
                window.location.href = 'index (2).html';
                return;
            }
            
            // Users massivind…ôn tam m…ôlumatlarƒ± al
            const users = getUsers();
            const fullUser = users.find(u => u.id === currentUser.id);
            
            // ∆èg…ôr tam m…ôlumat varsa, onu istifad…ô et
            const user = fullUser || currentUser;
            
            // Profil m…ôlumatlarƒ±nƒ± g√∂st…ôr
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('editName').value = user.name;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editPhone').value = user.phone || '';
            document.getElementById('editBirthdate').value = user.birthdate || '';
            document.getElementById('editAddress').value = user.address || '';
            document.getElementById('editBio').value = user.bio || '';
            
            // Qo≈üulma tarixi
            if (user.createdAt) {
                const date = new Date(user.createdAt);
                document.getElementById('joinedDate').textContent = date.toLocaleDateString(currentLanguage === 'az' ? 'az-AZ' : 'en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } else {
                document.getElementById('joinedDate').textContent = new Date().toLocaleDateString(currentLanguage === 'az' ? 'az-AZ' : 'en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            // Profil ≈ü…ôkli - users massivind…ôn al
            if (user.avatar) {
                document.getElementById('avatarImage').src = user.avatar;
                document.getElementById('avatarImage').style.display = 'block';
                document.getElementById('avatarPlaceholder').style.display = 'none';
            }
            
            // ƒ∞lk gedi≈ü endirimi badge - yalnƒ±z istifad…ô olunmayƒ±bsa g√∂st…ôr
            const discountBadge = document.getElementById('discountBadge');
            if (user.firstTripDiscount && user.firstTripDiscount.active && !user.firstTripDiscount.used) {
                discountBadge.style.display = 'flex';
            } else {
                discountBadge.style.display = 'none';
            }
            
            // Sevimlil…ôr - users massivind…ôn al
            if (fullUser) {
                // currentUser-ƒ± yenil…ô ki, favorites v…ô dig…ôr m…ôlumatlar d√ºzg√ºn olsun
                updateCurrentUser(fullUser);
            }
            
            // Sevimlil…ôr
            loadFavorites();
            
            // Sifari≈ül…ôr
            loadBookings();
            
            // R…ôyl…ôr
            loadReviews();
        }
        
        // Profil ≈ü…ôkli y√ºkl…ô
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showNotification(currentLanguage === 'az' ? '≈û…ôkil 2MB-dan b√∂y√ºk olmamalƒ±dƒ±r' : 'Image must be less than 2MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarData = e.target.result;
                
                // ≈û…ôkli g√∂st…ôr
                document.getElementById('avatarImage').src = avatarData;
                document.getElementById('avatarImage').style.display = 'block';
                document.getElementById('avatarPlaceholder').style.display = 'none';
                
                // Saxla
                const user = getCurrentUser();
                user.avatar = avatarData;
                updateCurrentUser(user);
                
                // Users massivind…ô d…ô yenil…ô
                const users = getUsers();
                const userIndex = users.findIndex(u => u.id === user.id);
                if (userIndex !== -1) {
                    users[userIndex].avatar = avatarData;
                    saveUsers(users);
                }
                
                showNotification(currentLanguage === 'az' ? '≈û…ôkil y√ºkl…ôndi!' : 'Photo uploaded!', 'success');
            };
            reader.readAsDataURL(file);
        }

        // Sevimlil…ôr
        function loadFavorites() {
            const currentUser = getCurrentUser();
            const users = getUsers();
            const fullUser = users.find(u => u.id === currentUser.id);
            const user = fullUser || currentUser;
            const favorites = user.favorites || [];
            
            // Daƒülar v…ô turlarƒ± ayƒ±r
            const mountains = favorites.filter(f => f.type === 'mountain' || !f.type);
            const tours = favorites.filter(f => f.type === 'tour');
            
            const mountainsContainer = document.getElementById('favoriteMountainsList');
            const toursContainer = document.getElementById('favoriteToursList');
            
            // Daƒülarƒ± g√∂st…ôr
            if (mountains.length === 0) {
                mountainsContainer.innerHTML = `
                    <div class="empty-state-small">
                        <p>${currentLanguage === 'az' ? 'H…ôl…ô sevimli daƒü yoxdur' : 'No favorite mountains yet'}</p>
                        <a href="index (2).html#map" class="explore-btn-small">${currentLanguage === 'az' ? 'X…ôrit…ôy…ô Ke√ß' : 'Go to Map'}</a>
                    </div>
                `;
            } else {
                mountainsContainer.innerHTML = mountains.map(fav => `
                    <div class="favorite-card">
                        <div class="fav-image" style="background-image: url('${fav.image || 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=400'}')">
                            <span class="fav-type-badge">üèîÔ∏è</span>
                        </div>
                        <div class="fav-info">
                            <h3>${fav.name}</h3>
                            <p>${fav.altitude || ''}</p>
                            <span class="fav-country">${fav.country || ''}</span>
                        </div>
                        <button class="remove-fav-btn" onclick="removeFavorite('${fav.id}')" title="${currentLanguage === 'az' ? 'Sil' : 'Remove'}">‚úï</button>
                    </div>
                `).join('');
            }
            
            // Turlarƒ± g√∂st…ôr
            if (tours.length === 0) {
                toursContainer.innerHTML = `
                    <div class="empty-state-small">
                        <p>${currentLanguage === 'az' ? 'H…ôl…ô sevimli tur yoxdur' : 'No favorite tours yet'}</p>
                        <a href="index (2).html#tours" class="explore-btn-small">${currentLanguage === 'az' ? 'Turlara Ke√ß' : 'Go to Tours'}</a>
                    </div>
                `;
            } else {
                toursContainer.innerHTML = tours.map(fav => `
                    <div class="favorite-card tour-fav">
                        <div class="fav-image" style="background-image: url('${fav.image || 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=400'}')">
                            <span class="fav-type-badge">üé´</span>
                        </div>
                        <div class="fav-info">
                            <h3>${fav.name}</h3>
                            <p class="fav-price">${fav.price || ''}</p>
                        </div>
                        <button class="remove-fav-btn" onclick="removeFavorite('${fav.id}')" title="${currentLanguage === 'az' ? 'Sil' : 'Remove'}">‚úï</button>
                    </div>
                `).join('');
            }
        }
        
        // Sevimlid…ôn sil
        function removeFavorite(favId) {
            const user = getCurrentUser();
            user.favorites = (user.favorites || []).filter(f => f.id !== favId);
            updateCurrentUser(user);
            
            // Users massivind…ô d…ô yenil…ô
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === user.id);
            if (userIndex !== -1) {
                users[userIndex].favorites = user.favorites;
                saveUsers(users);
            }
            
            loadFavorites();
            showNotification(currentLanguage === 'az' ? 'Sevimlil…ôrd…ôn silindi' : 'Removed from favorites', 'success');
        }

        // Sifari≈ül…ôr
        function loadBookings() {
            const currentUser = getCurrentUser();
            const users = getUsers();
            const fullUser = users.find(u => u.id === currentUser.id);
            const user = fullUser || currentUser;
            const bookings = user.bookings || [];
            const container = document.getElementById('bookingsList');
            
            if (bookings.length === 0) {
                return; // Empty state g√∂st…ôrilir
            }
            
            container.innerHTML = bookings.map(booking => `
                <div class="booking-card">
                    <div class="booking-icon">üé´</div>
                    <div class="booking-info">
                        <h3>${booking.tourName}</h3>
                        <p class="booking-date">${booking.date}</p>
                        <p class="booking-participants">${booking.participants} ${currentLanguage === 'az' ? 'n…ôf…ôr' : 'people'}</p>
                    </div>
                    <div class="booking-status ${booking.status}">${booking.status}</div>
                    <div class="booking-price">‚Çº${booking.price}</div>
                </div>
            `).join('');
        }

        // R…ôyl…ôr
        function loadReviews() {
            const currentUser = getCurrentUser();
            const users = getUsers();
            const fullUser = users.find(u => u.id === currentUser.id);
            const user = fullUser || currentUser;
            const reviews = user.reviews || [];
            const container = document.getElementById('reviewsList');
            
            if (reviews.length === 0) {
                return; // Empty state g√∂st…ôrilir
            }
            
            container.innerHTML = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-mountain">
                            <span class="review-icon">üèîÔ∏è</span>
                            <h3>${review.mountainName}</h3>
                        </div>
                        <div class="review-rating">
                            ${'‚≠ê'.repeat(review.rating)}
                        </div>
                    </div>
                    <p class="review-text">${review.text}</p>
                    <div class="review-footer">
                        <span class="review-date">${new Date(review.createdAt).toLocaleDateString(currentLanguage === 'az' ? 'az-AZ' : 'en-US')}</span>
                        <button class="delete-review-btn" onclick="deleteReview('${review.id}')" title="${currentLanguage === 'az' ? 'Sil' : 'Delete'}">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // R…ôyi sil
        function deleteReview(reviewId) {
            if (!confirm(currentLanguage === 'az' ? 'Bu r…ôyi silm…ôk ist…ôyirsiniz?' : 'Do you want to delete this review?')) {
                return;
            }
            
            const user = getCurrentUser();
            user.reviews = (user.reviews || []).filter(r => r.id !== reviewId);
            updateCurrentUser(user);
            
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === user.id);
            if (userIndex !== -1) {
                users[userIndex].reviews = user.reviews;
                saveUsers(users);
            }
            
            loadReviews();
            showNotification(currentLanguage === 'az' ? 'R…ôy silindi' : 'Review deleted', 'success');
        }

        // Profili redakt…ô et
        let isEditing = false;
        
        function toggleEdit() {
            isEditing = !isEditing;
            const inputs = document.querySelectorAll('#profileForm input, #profileForm textarea');
            const formActions = document.getElementById('formActions');
            const editBtn = document.getElementById('editProfileBtn');
            
            inputs.forEach(input => {
                if (input.id !== 'editEmail') { // Email d…ôyi≈üdirilm…ôsin
                    input.disabled = !isEditing;
                }
            });
            
            formActions.style.display = isEditing ? 'flex' : 'none';
            editBtn.style.display = isEditing ? 'none' : 'block';
        }

        // Profili saxla
        function saveProfile(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            const users = getUsers();
            const userIndex = users.findIndex(u => u.id === user.id);
            
            const updatedUser = {
                ...user,
                name: document.getElementById('editName').value,
                phone: document.getElementById('editPhone').value,
                birthdate: document.getElementById('editBirthdate').value,
                address: document.getElementById('editAddress').value,
                bio: document.getElementById('editBio').value
            };
            
            if (userIndex !== -1) {
                users[userIndex] = { ...users[userIndex], ...updatedUser };
                saveUsers(users);
            }
            
            updateCurrentUser(updatedUser);
            document.getElementById('profileName').textContent = updatedUser.name;
            
            toggleEdit();
            showNotification(currentLanguage === 'az' ? 'M…ôlumatlar saxlanƒ±ldƒ±!' : 'Information saved!', 'success');
        }

        // ≈ûifr…ôni d…ôyi≈ü
        function changePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            const errorEl = document.getElementById('passwordError');
            
            const user = getCurrentUser();
            const users = getUsers();
            const fullUser = users.find(u => u.id === user.id);
            
            if (!fullUser || fullUser.password !== currentPassword) {
                errorEl.textContent = currentLanguage === 'az' ? 'Cari ≈üifr…ô yanlƒ±≈üdƒ±r' : 'Current password is incorrect';
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                errorEl.textContent = currentLanguage === 'az' ? '≈ûifr…ôl…ôr uyƒüun g…ôlmir' : 'Passwords do not match';
                return;
            }
            
            if (newPassword.length < 6) {
                errorEl.textContent = currentLanguage === 'az' ? '≈ûifr…ô …ôn azƒ± 6 simvol olmalƒ±dƒ±r' : 'Password must be at least 6 characters';
                return;
            }
            
            // ≈ûifr…ôni yenil…ô
            const userIndex = users.findIndex(u => u.id === user.id);
            users[userIndex].password = newPassword;
            saveUsers(users);
            
            document.getElementById('passwordForm').reset();
            errorEl.textContent = '';
            showNotification(currentLanguage === 'az' ? '≈ûifr…ô yenil…ôndi!' : 'Password updated!', 'success');
        }

        // Hesabƒ± sil
        function deleteAccount() {
            const confirmMsg = currentLanguage === 'az' 
                ? 'Hesabƒ±nƒ±zƒ± silm…ôk ist…ôdiyiniz…ô …ôminsiniz? Bu …ôm…ôliyyat geri qaytarƒ±la bilm…ôz.'
                : 'Are you sure you want to delete your account? This action cannot be undone.';
            
            if (confirm(confirmMsg)) {
                const user = getCurrentUser();
                const users = getUsers();
                const filteredUsers = users.filter(u => u.id !== user.id);
                saveUsers(filteredUsers);
                localStorage.removeItem(CURRENT_USER_KEY);
                window.location.href = 'index (2).html';
            }
        }

        // √áƒ±xƒ±≈ü
        function logout() {
            localStorage.removeItem(CURRENT_USER_KEY);
            window.location.href = 'index (2).html';
        }

        // Bildiri≈ü
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Tab ke√ßidi
        function switchTab(tabId) {
            document.querySelectorAll('.profile-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.profile-nav-item').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            changeLanguage(currentLanguage);
            loadProfile();
            
            // Dil d√ºym…ôl…ôri
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => changeLanguage(btn.dataset.lang));
            });
            
            // Tab ke√ßidl…ôri
            document.querySelectorAll('.profile-nav-item').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });
            
            // Redakt…ô d√ºym…ôsi
            document.getElementById('editProfileBtn').addEventListener('click', toggleEdit);
            document.getElementById('cancelEditBtn').addEventListener('click', toggleEdit);
            
            // Profil formu
            document.getElementById('profileForm').addEventListener('submit', saveProfile);
            
            // ≈ûifr…ô formu
            document.getElementById('passwordForm').addEventListener('submit', changePassword);
            
            // Hesab silm…ô
            document.getElementById('deleteAccountBtn').addEventListener('click', deleteAccount);
            
            // √áƒ±xƒ±≈ü
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Avatar y√ºkl…ôm…ô
            document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
        });
    </script>
</body>
</html>

